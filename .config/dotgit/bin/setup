#!/bin/sh -e
if [ -e $GIT_WORK_TREE/README.md ]; then
	. /etc/os-release
	. /etc/lsb-release

	if [ $ID = "ubuntu" ]; then
		echo "deb http://ppa.launchpad.net/fish-shell/release-2/ubuntu $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/fish.list
		sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 6DC33CA5
		echo "deb http://ppa.launchpad.net/aacebedo/fasd/ubuntu $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/fasd.list
		sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E834F228
	else 
		echo 'deb http://download.opensuse.org/repositories/shells:/fish:/release:/2/Debian_9.0/ /' | sudo tee /etc/apt/sources.list.d/fish.list
	fi

	sudo apt update 

	sudo apt install -y httpie htop nano fish byobu curl wget python3-dev python3-pip mlocate sudo coreutils unzip nmap fasd grc
	sudo -H pip3 install thefuck youtube_dl
	sudo -H easy_install3 Pygments

	curl -Lo ~/.config/fish/functions/fisher.fish --create-dirs https://git.io/fisher

	curl https://raw.githubusercontent.com/scopatz/nanorc/master/install.sh | sh

	sudo wget -qO /usr/local/bin/tldr https://4e4.win/tldr
	sudo chmod +x /usr/local/bin/tldr

	fisher fzf z choices await shark menu get edc/bass 0rax/narwhal nyarly/fish-bang-bang laughedelic/pisces omf/thefuck omf/apt omf/extract omf/grc omf/fasd omf/msg omf/expand omf/technicolor omf/theme-bobthefish

	echo $(which byobu) | sudo tee -a /etc/shells
	echo $(which fish) | sudo tee -a /etc/shells
	echo $(which nologin) | sudo tee -a /etc/shells
	
	sudo chsh $USER --shell $(which fish) 

	rm $GIT_WORK_TREE/README.md
else
	echo "Setup alredy done"
fi

#TODO
# if not fast
# sudo apt upgrade -y
# below maybe in fish with questions?
# fish plugin with double esc to sudo on beginning of line
# sudo apt install node docker yarn virtualbox cockpit subline qgis chrome/chromium vscode
# sudo usermod --append --groups disk,sudo,www-data,docker,vboxusers $USER
